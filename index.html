<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr. William Herbal - Professional Export</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com">
    
    <!-- Libraries for Export -->
    <script src="https://cdnjs.cloudflare.com"></script>
    <script src="https://unpkg.com"></script>
    <script src="https://unpkg.com"></script>

    <style>
        body { font-family: 'Poppins', sans-serif; background: #f4f7f4; }
        .font-cinzel { font-family: 'Cinzel', serif; }
        
        .paper {
            background: white;
            width: 210mm;
            min-height: 297mm;
            padding: 20mm;
            margin: 20px auto;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
        }

        .expanding-input {
            width: 100%;
            border: none;
            outline: none;
            resize: none;
            overflow: hidden;
            background: transparent;
            display: block;
            white-space: pre-wrap;
        }

        @media print {
            .no-print { display: none !important; }
            body { background: white; }
            .paper { box-shadow: none; margin: 0; width: 100%; padding: 10mm; }
            .expanding-input { border: none !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [data, setData] = useState({
                name: '', age: '', date: new Date().toLocaleDateString(),
                address: '', meds: [{ id: 1, n: '', d: '', i: '' }],
                notes: ''
            });

            const paperRef = useRef();

            // Auto-expand function
            const handleInput = (e) => {
                e.target.style.height = 'auto';
                e.target.style.height = e.target.scrollHeight + 'px';
            };

            // EXPORT TO IMAGE
            const exportAsImage = () => {
                html2canvas(paperRef.current).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `Prescription_${data.name || 'Patient'}.png`;
                    link.href = canvas.toDataURL();
                    link.click();
                });
            };

            // EXPORT TO WORD (.docx)
            const exportToWord = () => {
                const content = `
                    <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word'>
                    <head><meta charset='utf-8'></head>
                    <body>
                        <h1 style='text-align:center; color:#1a472a;'>DR. WILLIAM HERBAL CLINIC</h1>
                        <p><b>Patient Name:</b> ${data.name}</p>
                        <p><b>Date:</b> ${data.date}</p>
                        <hr>
                        <h3>PRESCRIPTION:</h3>
                        ${data.meds.map(m => `<p>â€¢ ${m.n} - ${m.d} (${m.i})</p>`).join('')}
                        <br>
                        <h3>DOCTOR'S NOTES:</h3>
                        <p>${data.notes.replace(/\n/g, '<br>')}</p>
                    </body>
                    </html>`;
                const blob = new Blob(['\ufeff', content], { type: 'application/msword' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `Prescription_${data.name || 'Patient'}.doc`;
                link.click();
            };

            return React.createElement('div', { className: "pb-20" },
                // Toolbar
                React.createElement('div', { className: "no-print sticky top-0 bg-white shadow-md p-4 flex justify-center gap-4 z-50" },
                    React.createElement('button', { onClick: () => window.print(), className: "bg-green-700 text-white px-4 py-2 rounded flex items-center gap-2" }, 
                        React.createElement('i', { className: "fas fa-file-pdf" }), "Print / Save PDF"),
                    React.createElement('button', { onClick: exportAsImage, className: "bg-blue-600 text-white px-4 py-2 rounded flex items-center gap-2" }, 
                        React.createElement('i', { className: "fas fa-image" }), "Save as Image"),
                    React.createElement('button', { onClick: exportToWord, className: "bg-blue-800 text-white px-4 py-2 rounded flex items-center gap-2" }, 
                        React.createElement('i', { className: "fas fa-file-word" }), "Save as Word")
                ),

                // Prescription Paper
                React.createElement('div', { ref: paperRef, className: "paper", id: "prescription" },
                    // Header
                    React.createElement('div', { className: "text-center border-b-4 border-green-900 pb-4 mb-6" },
                        React.createElement('h1', { className: "font-cinzel text-4xl text-green-900" }, "DR. WILLIAM HERBAL"),
                        React.createElement('p', { className: "text-sm italic" }, "Natural Medicine & Wellness Expert | Dar es Salaam")
                    ),

                    // Patient Info
                    React.createElement('div', { className: "grid grid-cols-2 gap-6 mb-8" },
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-xs font-bold text-gray-500" }, "PATIENT NAME"),
                            React.createElement('input', { 
                                value: data.name, 
                                onChange: (e) => setData({...data, name: e.target.value}),
                                className: "w-full border-b border-gray-300 outline-none py-1 font-semibold",
                                placeholder: "Enter patient name"
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-xs font-bold text-gray-500" }, "DATE"),
                            React.createElement('input', { 
                                value: data.date, 
                                onChange: (e) => setData({...data, date: e.target.value}),
                                className: "w-full border-b border-gray-300 outline-none py-1"
                            })
                        )
                    ),

                    // Prescription Rx
                    React.createElement('div', { className: "text-4xl text-green-900 font-serif italic mb-4" }, "Rx"),
                    
                    // Meds Table
                    React.createElement('table', { className: "w-full mb-10" },
                        React.createElement('thead', { className: "bg-gray-100 text-left" },
                            React.createElement('tr', null,
                                React.createElement('th', { className: "p-2 border" }, "Herbal Medicine"),
                                React.createElement('th', { className: "p-2 border w-1/4" }, "Dosage"),
                                React.createElement('th', { className: "p-2 border" }, "Instructions")
                            )
                        ),
                        React.createElement('tbody', null,
                            data.meds.map((m, idx) => 
                                React.createElement('tr', { key: m.id },
                                    React.createElement('td', { className: "border p-1" }, 
                                        React.createElement('textarea', { 
                                            onInput: handleInput,
                                            onChange: (e) => {
                                                const newMeds = [...data.meds];
                                                newMeds[idx].n = e.target.value;
                                                setData({...data, meds: newMeds});
                                            },
                                            className: "expanding-input p-1", placeholder: "Medicine name..." 
                                        })
                                    ),
                                    React.createElement('td', { className: "border p-1" }, 
                                        React.createElement('input', { className: "w-full outline-none p-1", placeholder: "e.g. 2x3" })
                                    ),
                                    React.createElement('td', { className: "border p-1" }, 
                                        React.createElement('textarea', { 
                                            onInput: handleInput,
                                            className: "expanding-input p-1", placeholder: "Instructions..." 
                                        })
                                    )
                                )
                            )
                        )
                    ),

                    React.createElement('button', { 
                        onClick: () => setData({...data, meds: [...data.meds, {id: Date.now(), n:'', d:'', i:''}]}),
                        className: "no-print text-green-700 text-sm font-bold mb-10" 
                    }, "+ Add Medicine"),

                    // NOTES SECTION (Crucial for Print)
                    React.createElement('div', { className: "mt-10" },
                        React.createElement('h3', { className: "font-bold text-green-900 border-b-2 border-green-900 mb-2" }, "DOCTOR'S NOTES & ADVICE"),
                        React.createElement('textarea', {
                            onInput: handleInput,
                            value: data.notes,
                            onChange: (e) => setData({...data, notes: e.target.value}),
                            className: "expanding-input min-h-[200px] text-gray-700 leading-relaxed",
                            placeholder: "Andika maelezo yote ya tiba hapa..."
                        })
                    ),

                    // Footer
                    React.createElement('div', { className: "absolute bottom-10 right-10 text-center" },
                        React.createElement('div', { className: "w-40 border-b-2 border-gray-400 mb-2" }),
                        React.createElement('p', { className: "font-bold" }, "Dr. William"),
                        React.createElement('p', { className: "text-xs text-gray-500" }, "Certified Herbal Specialist")
                    )
                )
            );
        };

        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>
