<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr. William Herbal - Professional Export</title>
    
    <!-- LIBRARIES ZILIZOREKEBISHWA -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com">
    
    <!-- Export Libraries -->
    <script src="https://cdnjs.cloudflare.com"></script>
    <script src="https://unpkg.com"></script>
    <script src="https://unpkg.com"></script>

    <style>
        body { font-family: 'Poppins', sans-serif; background: #f4f7f4; }
        .font-cinzel { font-family: 'Cinzel', serif; }
        
        .paper {
            background: white;
            width: 210mm;
            min-height: 297mm;
            padding: 20mm;
            margin: 20px auto;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
        }

        .expanding-input {
            width: 100%;
            border: none;
            outline: none;
            resize: none;
            overflow: hidden;
            background: transparent;
            display: block;
            white-space: pre-wrap;
            min-height: 24px;
        }

        /* Maboresho ya Print */
        @media print {
            .no-print { display: none !important; }
            body { background: white !important; }
            .paper { 
                box-shadow: none !important; 
                margin: 0 !important; 
                width: 100% !important; 
                padding: 10mm !important;
                height: auto !important;
            }
            .expanding-input { border: none !important; }
            @page { size: A4; margin: 0; }
        }

        .btn-tool {
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 6px;
            color: white;
            font-weight: 500;
        }
        .btn-tool:hover { transform: translateY(-2px); opacity: 0.9; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [data, setData] = useState({
                name: '', age: '', date: new Date().toLocaleDateString(),
                address: '', meds: [{ id: 1, n: '', d: '', i: '' }],
                notes: ''
            });

            const paperRef = useRef();

            // Auto-expand function
            const handleInput = (e) => {
                e.target.style.height = 'auto';
                e.target.style.height = e.target.scrollHeight + 'px';
            };

            // EXPORT TO IMAGE (PNG)
            const exportAsImage = () => {
                const btn = document.querySelector('.no-print');
                btn.style.display = 'none'; // Ficha buttons muda wa kupiga picha
                html2canvas(paperRef.current, { scale: 2 }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `Prescription_${data.name || 'Patient'}.png`;
                    link.href = canvas.toDataURL("image/png");
                    link.click();
                    btn.style.display = 'flex';
                });
            };

            // EXPORT TO WORD (.doc)
            const exportToWord = () => {
                const content = `
                    <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word'>
                    <head><meta charset='utf-8'></head>
                    <body style="font-family:Arial">
                        <h1 style='text-align:center; color:#1a472a;'>DR. WILLIAM HERBAL CLINIC</h1>
                        <p><b>Patient Name:</b> ${data.name}</p>
                        <p><b>Date:</b> ${data.date}</p>
                        <hr>
                        <h3>PRESCRIPTION (Rx):</h3>
                        <table border="1" cellspacing="0" cellpadding="5" style="width:100%">
                            <tr><th>Medicine</th><th>Dosage</th><th>Instructions</th></tr>
                            ${data.meds.map(m => `<tr><td>${m.n}</td><td>${m.d}</td><td>${m.i}</td></tr>`).join('')}
                        </table>
                        <br>
                        <h3>DOCTOR'S NOTES:</h3>
                        <p>${data.notes.replace(/\n/g, '<br>')}</p>
                    </body>
                    </html>`;
                const blob = new Blob(['\ufeff', content], { type: 'application/msword' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `Prescription_${data.name || 'Patient'}.doc`;
                link.click();
            };

            return React.createElement('div', { className: "pb-20" },
                // Toolbar
                React.createElement('div', { className: "no-print sticky top-0 bg-white shadow-md p-4 flex justify-center gap-4 z-50" },
                    React.createElement('button', { onClick: () => window.print(), className: "btn-tool bg-green-700" }, 
                        React.createElement('i', { className: "fas fa-file-pdf" }), "PDF / Print"),
                    React.createElement('button', { onClick: exportAsImage, className: "btn-tool bg-blue-600" }, 
                        React.createElement('i', { className: "fas fa-image" }), "Save Image"),
                    React.createElement('button', { onClick: exportToWord, className: "btn-tool bg-slate-800" }, 
                        React.createElement('i', { className: "fas fa-file-word" }), "Save Word")
                ),

                // Prescription Paper
                React.createElement('div', { ref: paperRef, className: "paper", id: "prescription" },
                    // Header
                    React.createElement('div', { className: "text-center border-b-4 border-green-900 pb-4 mb-6" },
                        React.createElement('h1', { className: "font-cinzel text-4xl text-green-900" }, "DR. WILLIAM HERBAL"),
                        React.createElement('p', { className: "text-sm italic" }, "Natural Medicine & Wellness Expert | Dar es Salaam")
                    ),

                    // Patient Info
                    React.createElement('div', { className: "grid grid-cols-2 gap-6 mb-8" },
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-[10px] font-bold text-gray-500" }, "PATIENT NAME"),
                            React.createElement('input', { 
                                value: data.name, 
                                onChange: (e) => setData({...data, name: e.target.value}),
                                className: "w-full border-b border-gray-300 outline-none py-1 font-semibold",
                                placeholder: "Enter name"
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-[10px] font-bold text-gray-500" }, "DATE"),
                            React.createElement('input', { 
                                value: data.date, 
                                onChange: (e) => setData({...data, date: e.target.value}),
                                className: "w-full border-b border-gray-300 outline-none py-1"
                            })
                        )
                    ),

                    React.createElement('div', { className: "text-4xl text-green-900 font-serif italic mb-4" }, "Rx"),
                    
                    // Table
                    React.createElement('table', { className: "w-full mb-6 border-collapse" },
                        React.createElement('thead', { className: "bg-gray-50 text-left" },
                            React.createElement('tr', null,
                                React.createElement('th', { className: "p-2 border text-xs" }, "Herbal Medicine"),
                                React.createElement('th', { className: "p-2 border text-xs w-24" }, "Dosage"),
                                React.createElement('th', { className: "p-2 border text-xs" }, "Instructions")
                            )
                        ),
                        React.createElement('tbody', null,
                            data.meds.map((m, idx) => 
                                React.createElement('tr', { key: m.id },
                                    React.createElement('td', { className: "border p-1" }, 
                                        React.createElement('textarea', { 
                                            value: m.n,
                                            onInput: handleInput,
                                            onChange: (e) => {
                                                const newMeds = [...data.meds];
                                                newMeds[idx].n = e.target.value;
                                                setData({...data, meds: newMeds});
                                            },
                                            className: "expanding-input text-sm", placeholder: "Name..." 
                                        })
                                    ),
                                    React.createElement('td', { className: "border p-1" }, 
                                        React.createElement('input', { 
                                            value: m.d,
                                            onChange: (e) => {
                                                const newMeds = [...data.meds];
                                                newMeds[idx].d = e.target.value;
                                                setData({...data, meds: newMeds});
                                            },
                                            className: "w-full outline-none p-1 text-sm", placeholder: "2x3" 
                                        })
                                    ),
                                    React.createElement('td', { className: "border p-1" }, 
                                        React.createElement('textarea', { 
                                            value: m.i,
                                            onInput: handleInput,
                                            onChange: (e) => {
                                                const newMeds = [...data.meds];
                                                newMeds[idx].i = e.target.value;
                                                setData({...data, meds: newMeds});
                                            },
                                            className: "expanding-input text-sm", placeholder: "Instructions..." 
                                        })
                                    )
                                )
                            )
                        )
                    ),

                    React.createElement('button', { 
                        onClick: () => setData({...data, meds: [...data.meds, {id: Date.now(), n:'', d:'', i:''}]}),
                        className: "no-print text-green-700 text-xs font-bold mb-8 hover:underline" 
                    }, "+ Add Medicine"),

                    // NOTES
                    React.createElement('div', { className: "mt-4" },
                        React.createElement('h3', { className: "font-bold text-green-900 border-b-2 border-green-900 mb-2 text-sm" }, "DOCTOR'S NOTES & ADVICE"),
                        React.createElement('textarea', {
                            onInput: handleInput,
                            value: data.notes,
                            onChange: (e) => setData({...data, notes: e.target.value}),
                            className: "expanding-input min-h-[150px] text-gray-700 text-sm leading-relaxed",
                            placeholder: "Andika maelezo ya tiba hapa..."
                        })
                    ),

                    // Sign
                    React.createElement('div', { className: "absolute bottom-16 right-20 text-center" },
                        React.createElement('div', { className: "w-32 border-b border-gray-400 mb-1" }),
                        React.createElement('p', { className: "font-bold text-xs" }, "Dr. William"),
                        React.createElement('p', { className: "text-[10px] text-gray-400" }, "Authorized Expert")
                    )
                )
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
