<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr. William Herbal Â· Prescription System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Cinzel:wght@700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        body { font-family: 'Poppins', sans-serif; background: #f8faf8; }
        .font-cinzel { font-family: 'Cinzel', serif; }
        .font-playfair { font-family: 'Playfair Display', serif; }
        @media print {
            .no-print { display: none !important; }
            body { background: white; }
            #prescription-paper { box-shadow: none !important; border: none !important; width: 100% !important; margin: 0 !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Custom Component for Icons ---
        const Icon = ({ name, size = 18, className = "" }) => {
            useEffect(() => { lucide.createIcons(); }, []);
            return <i data-lucide={name} className={className} style={{ width: size, height: size }}></i>;
        };

        const App = () => {
            const [data, setData] = useState({
                patientName: '',
                patientAddress: '',
                date: new Date().toISOString().split('T')[0],
                patientAgeGender: '',
                medications: [
                    { id: '1', name: 'Dawa Namba 1', dosage: 'Asubuhi & Jioni', instructions: 'Changanya kwenye uji maalum wa mafuta ya mnyonyo.' },
                    { id: '2', name: 'Dawa Namba 2', dosage: 'Mchana', instructions: 'Vitunguu saumu 4 na chumvi kidogo.' }
                ],
                doctorNotes: 'Zingatia masharti ya uandaaji wa mafuta ya mnyonyo.'
            });

            const paperRef = useRef(null);

            const addRow = () => {
                const newRow = { id: Math.random().toString(36).substr(2, 9), name: '', dosage: '', instructions: '' };
                setData(prev => ({ ...prev, medications: [...prev.medications, newRow] }));
            };

            const updateRow = (id, field, value) => {
                setData(prev => ({
                    ...prev,
                    medications: prev.medications.map(row => row.id === id ? { ...row, [field]: value } : row)
                }));
            };

            const exportPDF = () => {
                const element = paperRef.current;
                html2canvas(element, { scale: 2 }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
                    pdf.addImage(imgData, 'PNG', 0, 0, 210, (canvas.height * 210) / canvas.width);
                    pdf.save(`Tiba_${data.patientName}.pdf`);
                });
            };

            return (
                <div className="min-h-screen py-10 px-4">
                    {/* Controls */}
                    <div className="max-w-4xl mx-auto mb-8 flex flex-wrap gap-3 no-print justify-center">
                        <button onClick={addRow} className="bg-green-700 text-white px-6 py-2 rounded-lg flex items-center gap-2 hover:bg-green-800 transition shadow-md">
                            <Icon name="plus-circle" /> Ongeza Dawa
                        </button>
                        <button onClick={exportPDF} className="bg-emerald-600 text-white px-6 py-2 rounded-lg flex items-center gap-2 hover:bg-emerald-700 transition shadow-md">
                            <Icon name="file-down" /> Pakua PDF
                        </button>
                        <button onClick={() => window.print()} className="bg-slate-800 text-white px-6 py-2 rounded-lg flex items-center gap-2 hover:bg-slate-900 transition shadow-md">
                            <Icon name="printer" /> Chapisha
                        </button>
                    </div>

                    {/* Prescription Sheet */}
                    <div ref={paperRef} id="prescription-paper" className="max-w-[800px] mx-auto bg-white shadow-2xl p-10 border-t-[10px] border-green-700 rounded-lg relative overflow-hidden">
                        
                        {/* Header */}
                        <div className="text-center border-b-2 border-green-100 pb-6 mb-8">
                            <div className="flex justify-center mb-4">
                                <div className="w-16 h-16 bg-green-700 rounded-full flex items-center justify-center text-white">
                                    <Icon name="leaf" size={32} />
                                </div>
                            </div>
                            <h1 className="font-cinzel text-3xl text-green-900">DR. WILLIAM HERBAL CLINIC</h1>
                            <p className="text-amber-700 text-sm tracking-widest font-bold">TIBA ASILI NA LISHE</p>
                            <div className="flex justify-center gap-6 mt-4 text-xs text-gray-500">
                                <span className="flex items-center gap-1"><Icon name="phone" size={12}/> +255 762 286 282</span>
                                <span className="flex items-center gap-1"><Icon name="map-pin" size={12}/> Kitunda, Dar es Salaam</span>
                            </div>
                        </div>

                        {/* Patient Info */}
                        <div className="grid grid-cols-2 gap-4 mb-8 bg-green-50 p-4 rounded-lg">
                            <div className="flex flex-col">
                                <label className="text-[10px] font-bold text-green-800">JINA LA MGONJWA</label>
                                <input value={data.patientName} onChange={e => setData({...data, patientName: e.target.value})} className="bg-transparent border-b border-green-200 outline-none py-1 font-medium" />
                            </div>
                            <div className="flex flex-col">
                                <label className="text-[10px] font-bold text-green-800">TAREHE</label>
                                <input type="date" value={data.date} onChange={e => setData({...data, date: e.target.value})} className="bg-transparent border-b border-green-200 outline-none py-1" />
                            </div>
                        </div>

                        <div className="text-4xl font-cinzel text-amber-600 mb-4 opacity-50">Rx</div>

                        {/* Table */}
                        <table className="w-full mb-10">
                            <thead>
                                <tr className="bg-green-700 text-white text-left text-xs uppercase">
                                    <th className="p-3">Dawa</th>
                                    <th className="p-3">Dosi</th>
                                    <th className="p-3">Maelekezo ya Matumizi</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-100">
                                {data.medications.map(row => (
                                    <tr key={row.id}>
                                        <td className="p-3"><input value={row.name} onChange={e => updateRow(row.id, 'name', e.target.value)} className="w-full outline-none font-bold text-green-900" /></td>
                                        <td className="p-3"><input value={row.dosage} onChange={e => updateRow(row.id, 'dosage', e.target.value)} className="w-full outline-none" /></td>
                                        <td className="p-3"><textarea value={row.instructions} onChange={e => updateRow(row.id, 'instructions', e.target.value)} className="w-full outline-none text-sm italic text-gray-600 resize-none" rows="2" /></td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>

                        {/* Notes */}
                        <div className="border-l-4 border-amber-500 bg-amber-50 p-4 mb-10">
                            <h4 className="text-xs font-bold text-amber-800 mb-2 uppercase italic">Maelekezo Muhimu ya Daktari:</h4>
                            <textarea value={data.doctorNotes} onChange={e => setData({...data, doctorNotes: e.target.value})} className="w-full bg-transparent outline-none text-sm text-gray-700 min-h-[80px]" />
                        </div>

                        {/* Footer */}
                        <div className="flex justify-between mt-12 pt-10 border-t border-gray-100">
                            <div className="text-center">
                                <div className="w-40 border-b border-gray-400 mb-2"></div>
                                <p className="text-[10px] font-bold">SAHIHI YA DAKTARI</p>
                            </div>
                            <div className="text-center">
                                <div className="w-40 border-b border-gray-400 mb-2"></div>
                                <p className="text-[10px] font-bold">MUHURI WA CLINIC</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
